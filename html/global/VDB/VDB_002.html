<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="format-detection" content="telephone=no">
  <title>VDB_002</title>

  <link rel="stylesheet" href="../../..../../../css/hmui/swiper.css">
  <link rel="stylesheet" href="../../../css/hmui/animate.css">
  <link rel="stylesheet" href="../../../css/hmui/common.css">
  <link rel="stylesheet" href="../../../css/global/contents.css">
  <script src="../../../js/hmui/lib/jquery-1.12.3.min.js"></script>
  <script src="../../../js/hmui/lib/swiper.js"></script>
  <script src="../../../js/hmui/lib/waypoints.min.js"></script>
  <script src="../../../js/hmui/lib/jquery.counterup.js"></script>
  <script src="../../../js/hmui/ui_common.js"></script>
</head>
<body>
  <main id="root">
    <header id="header">
      <div class="inner_fixed">
        <button class="btn_ico_prev"><span class="blind">이전</span></button>
        <h1>혜택마스터</h1>
        <button class="btn_ico_menu"><span class="blind">전체메뉴</span></button>
      </div>
    </header>
    <!-- // header -->

    <div id="contents" class="wrap_contents">
      <div class="contents">
        <section data-roll="VDB">
          <div class="section_top_visual vdb_master">
            <div class="wrap_dropdown">
              <button type="button" class="btn_dropdown"><span class="current">4월</span></button>
              <ul class="list_dropdown">
                <li><button type="button"><span>3월</span></button></li>
                <li><button type="button"><span>2월</span></button></li>
              </ul>
            </div>

            <div class="swiper-container vdb_swiper">
              <!-- slide info - swipe 시 slide_info 값 받아서 변경 -->
              <div class="tit_winner" data-rank="1" aria-hidden="true">
                <p class="img_vdb_rank"></p>
                <p class="title">혜택받기 끝판왕</p>
                <strong><span class="rank">1</span>위 <span class="name">김**</span></strong>
              </div>
              <p class="txt_amount" aria-hidden="true">총 <em class="txt_num"></em>원</p>
              <!-- // slide info -->

              <div class="swiper-wrapper">
                <!-- 1위 -->
                <div class="swiper-slide swiper-slide-active" data-first>
                  <div class="slide_info blind">
                    <p class="title">혜택받기 끝판왕</p>
                    <p class="name">김**</p>
                    <p class="amount">9,999,999</p>
                  </div>
                  <div class="img_avatar rank1" aria-hidden="true">
                    <img src="../../../images/global/avatar/avatar_1.png">
                  </div>
                </div>
                
                <!-- 3위 - 은금동 순서를 위해 3위 2위 보다 먼저 생성-->
                <div class="swiper-slide swiper-slide-next">
                  <div class="slide_info blind">
                    <p class="title">혜택받기 살림꾼</p>
                    <p class="name">하**</p>
                    <p class="amount">7,999,999</p>
                  </div>
                  <div class="img_avatar rank3" aria-hidden="true">
                    <img src="../../../images/global/avatar/avatar_8.png">
                  </div>
                </div>

                <!-- 2위 -->
                <div class="swiper-slide swiper-slide-prev">
                  <div class="slide_info blind">
                    <p class="title">혜택받기 마스터</p>
                    <p class="name">우**</p>
                    <p class="amount">8,999,999</p>
                  </div>
                  <div class="img_avatar rank2" aria-hidden="true">
                    <img src="../../../images/global/avatar/avatar_7.png">
                  </div>
                </div>
              </div>
              <div class="swiper-pagination">
                <span class="swiper-pagination-bullet swiper-pagination-bullet-active"></span>
                <span class="swiper-pagination-bullet"></span>
                <span class="swiper-pagination-bullet"></span>
              </div>
            </div>

            <div class="wrap_box bg_white">
              <div class="chart_bar_stacked">
                <div class="bar" data-percent="50"><span class="legend">모은 돈</span><em class="txt_num">950,022</em></div>
                <div class="bar" data-percent="50"><span class="legend">아낀 돈</span><em class="txt_num">100,000</em></div>
              </div>
            </div>
          </div>

          <div class="section_cont">
            <h3 class="tit_section_2"><em>1위가 이용한 혜택</em>으로<br>나도 이용하기</h3>
            <ul class="list_masters_benefit">
              <li>
                <a href="#none" class="category_card"><span>카드사용 적립</span><img src="../../../images/global/@vdb_category_card.png"></a>
              </li>
              <li>
                <a href="#none" class="category_evt"><span>이벤트 적립</span><img src="../../../images/global/@vdb_category_evt.png"></a>
              </li>
              <li>
                <a href="#none" class="category_free"><span>무료 적립</span><img src="../../../images/global/@vdb_category_free.png"></a>
              </li>
            </ul>
            <!-- 카테고리 리스트
            <a href="#none" class="category_card"><span>카드사용 적립</span><img src="../../../images/global/@vdb_category_card.png"></a>
            <a href="#none" class="category_evt"><span>이벤트 적립</span><img src="../../../images/global/@vdb_category_evt.png"></a>
            <a href="#none" class="category_free"><span>무료 적립</span><img src="../../../images/global/@vdb_category_free.png"></a>
            <a href="#none" class="category_point"><span>포인트 전환적립</span><img src="../../../images/global/@vdb_category_point.png"></a>
            <a href="#none" class="category_gift"><span>선물하기 적립</span><img src="../../../images/global/@vdb_category_gift.png"></a>
            <a href="#none" class="category_exch"><span>무료환전 적립</span><img src="../../../images/global/@vdb_category_exch.png"></a>
            <a href="#none" class="category_charge"><span>수수료 면제혜택</span><img src="../../../images/global/@vdb_category_charge.png"></a>
            -->
            <ul class="list_masters_benefit">
              <li><a href="#none" class="category_point"><span>포인트 전환적립</span><img src="../../../images/global/@vdb_category_point.png"></a></li>
              <li><a href="#none" class="category_gift"><span>선물하기 적립</span><img src="../../../images/global/@vdb_category_gift.png"></a></li>
              <li><a href="#none" class="category_exch"><span>무료환전 적립</span><img src="../../../images/global/@vdb_category_exch.png"></a></li>
            </ul>
            <ul class="list_masters_benefit">
              <li><a href="#none" class="category_charge"><span>수수료 면제혜택</span><img src="../../../images/global/@vdb_category_charge.png"></a></li>
            </ul>
          </div>

          <div class="section_cont type_narrow vdb_travlog">
            <div class="wrap_banner">
              <p class="txt_sub_2">수수료 없는 세상을 경험하세요.</p>
              <p class="tit_2">환전수수료<br>해외결제 수수료<br>해외 ATM 출금 수수료</p>
            </div>
            <div class="wrap_btn type_full">
              <a href="#none" class="btn_box_m type_line rounded">트래블로그 혜택 자세히보기</a>
            </div>
          </div>

          <div class="section_cont">
            <h3 class="tit_section_center_2">내가 <em class="txt_point_1">모은 돈</em>은 얼마고,<br><em class="txt_point_1">아낀 돈</em>은 얼마일까요?</h3>
            <div class="wrap_btn type_full">
              <a href="#none" class="btn_box_m btn_primary rounded">내가 받은 혜택 보러가기</a>
            </div>
          </div>

          <div class="wrap_notice">
            <h4 class="tit_notice"><span class="ico_notice"></span>알려드립니다!</h4>
            <ul class="list_txt">
              <li><strong>혜택마스터 선정기준 :</strong> 하나머니 서비스 3개 이상 이용하신 손님 중 하나머니 선정기준에 따라 가장 많은 혜택을 받은 상위 3명을 선정합니다.</li>
              <li><strong>모은 돈 :</strong> 무료적립, 포인트전환 적립, 선물하기 적립, 카드사용 적립, 이벤트 적립 등을 통해 받은 하나머니 적립금액입니다. 적립 금액중 일부는 제외될 수 있습니다.</li>
              <li><strong>아낀 돈 :</strong> 트래블로그 서비스를 통해 아낀 수수료입니다.  전 영업일 기준 하나은행 최종 매매기준율로 계산한 예측 금액입니다.</li>
            </ul>
          </div>
        </section>
        <!-- // section -->
      </div>
    </div>
    <!-- // contents-->

  </main>
  
  <script>
  // 캐릭터 랜덤 swiper init 전 설정
  randomCharacter();
  function randomCharacter() {
    var randomArr = [];
    while(randomArr.length < 3){
      var num = Math.floor(Math.random() * 8) + 1;
      if ( randomArr.indexOf(num) === -1) {
        randomArr.push(num);
      }
    }

    // 같은 성별의 캐릭터만 나왔을 경우 첫번째를 이성 캐릭터로 변경
    if ( randomArr.every(function(num) { num < 5 }) ){
      randomArr[0] = Math.floor(Math.random()*(8-5+1)) + 5;
    } else if ( randomArr.every(function(num) { num > 4 }) ) {
      randomArr[0] = Math.floor(Math.random()*(4-1+1)) + 1;
    }

    // 캐릭터이미지 url 변경
    randomArr.map(function(num, idx) {
      var url = '../../../images/global/avatar/avatar_' + num + '.png'; 
      $('.swiper-slide').eq(idx).find('.img_avatar img').attr('src', url);
    });
  }

  $(function() {
    // swiper init
    var swiper = new Swiper(".vdb_swiper", {
      loop: true,
      grabCursor: true,
      centeredSlides: true,
      slidesPerView: 'auto',
      on : {
        init: function(){
          var idx = this.realIndex;
          var $active = $(this.slides[idx]); 
          // slide_info 변경
          changeSlideInfo(idx, $active);
          // bar chart animation
          fnAnimateBar('.chart_bar_stacked');
        },
      }
    });

    // 스와이프 시
    swiper.on('slideChange', function() {
      var wrapperEl = $(this.wrapperEl); // swiper-wrapper
      var idx = this.realIndex; // active slide index
      var $active = $(this.slides[idx]); // active slide

      // pagination 2위,3위 slide 순서 변경으로 인한 별도 pagination 설정
      var pageIdx;
      var pagination = wrapperEl.siblings('.swiper-pagination').find('.swiper-pagination-bullet');
      if ( idx === 1 ){
        pageIdx = 2;
      } else if ( idx === 2 ) {
        pageIdx = 1;
      } else {
        pageIdx = 0;
      }
      pagination.removeClass('swiper-pagination-bullet-active');
      pagination.eq(pageIdx).addClass('swiper-pagination-bullet-active');

      // slide_info 변경
      changeSlideInfo(idx, $active);

      // bar chart animation
      // 모은돈, 아낀돈 금액 data 변경 후 fnAnimateBar() 실헹하면 percentage 계산되어 bar chart 애니메이션
      $('.chart_bar_stacked').find('.bar').eq(0).find('.txt_num').text('1,000,000'); //data 변경 확인용 
      $('.chart_bar_stacked').find('.bar').eq(1).find('.txt_num').text('456,234');
      fnAnimateBar('.chart_bar_stacked');
    });

    // 월 선택 시
    $('.list_dropdown').find('button').on('click', function(){
      // 1위 slide가 아닌 경우 1위 slide로 이동
      if (swiper.realIndex !== 0 ){
        swiper.slideTo(3);
      }
    });

    function changeSlideInfo(idx, el) {
      if ( idx == 2) {
        idx = 1 
      } else if (idx ==1 ) (
        idx = 2
      )
      var title = $(el).find('.title').text(),
          name = $(el).find('.name').text(),
          amount = $(el).find('.amount').text(),
          winner = $('.tit_winner');
      winner.attr('data-rank', idx+1);
      winner.find('.title').text(title);
      winner.find('.name').text(name);
      winner.find('.rank').text(idx+1);
      winner.next('.txt_amount').find('.txt_num').text(amount);
    }

  });
  </script>
</body>
</html>